<script>const SingleSlim=(()=>{let t;return{getInstance:()=>(t||(t=slim.create({},!0)),t)}})();function path(t,e){t=Array.isArray(t)?t:t.split(".");let a=e,n=0;for(;n<t.length;){if(null==a)return;a=a[t[n]],n+=1}return a}function set(t,e,a){for(var n=a,s=Array.isArray(t)?t:t.split("."),i=s.length,r=0;r<i-1;r++){var l=s[r];n[l]||(n[l]={}),n=n[l]}n[s[i-1]]=e}class MyElement extends HTMLElement{constructor(){super(),this.observe=slim.observe,this._listeners=[],this._mapper={},this.context=SingleSlim.getInstance(),this._ctxMapper={},this.computed={},this.initState()}connectedCallback(){console.log(),this.shadow?this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(this.template.content)):this.appendChild(document.importNode(this.template.content,!0)),this.compile()}initState(){const t=this,e=(t.data instanceof Function?t.data:()=>t.data||{})();this.data=slim.create(e,!0,e=>{e.map(e=>{Object.keys(t._mapper).filter(t=>t.startsWith(e.currentPath)).map(e=>t._mapper[e].map(({name:a,node:n})=>{const s=path(e,t.data);"children"===a?n.innerText=s:(n.setAttribute(a,s),"value"===a&&(n.value=s))}))})})}compile(t=this,e={}){const a=this;Array.from(t.querySelectorAll("[x-for]")).map(t=>{const[n,s]=t.attributes["x-for"].value.split(":");t.removeAttribute("x-for");const i=t.cloneNode(!0);t.style.display="none",t.className="";const r=document.createDocumentFragment();let l=[];const o=o=>{l.map(t=>t.parentNode.removeChild(t)),(l=path(s,a.data).map((t,a)=>{const s=i.cloneNode(!0);return s.setAttribute("key",a),this.applyListeners(s),this.activateBinds(s,Object.assign({},e,{[n]:t})),this.activateContext(s),this.compile(s,Object.assign({},e,{[n]:t})),s})).map(r.appendChild.bind(r)),t.parentNode.insertBefore(r,t.nextSibling)};a.observe(a.data,o.bind(a)),o()}),Array.from(t.querySelectorAll("[x-if]")).map(t=>{const e=t.attributes["x-if"].value;t.removeAttribute("x-if");const n=()=>{path(e,a.data)||path(e,a.context)||path(e,a)?"none"===t.style.display&&(t.style.display=t.getAttribute("display")||"block"):"none"!==t.style.display&&(t.setAttribute("display",t.style.display),t.style.display="none")};a.observe(a.data,n.bind(a)),a.observe(a.context,n.bind(a)),n()}),Array.from(t.querySelectorAll("*")).filter(t=>!Object.keys(t.attributes).find(t=>t.startsWith("x-"))).map(t=>{this.applyListeners(t),this.activateBinds(t,e),this.activateContext(t)})}activateBinds(t,e={}){const a=this;Array.from(t.attributes).filter(t=>t.name.startsWith(":")).map(n=>{t.removeAttribute(n.name);const s=path(n.value,a.computed)instanceof Function?path(n.value,a.computed):null,i=n.name.slice(1),r=e.hasOwnProperty(n.value)?e[n.value]:s?s.call(a,t,e):path(n.value,this.data);"children"===i?t.innerText=""+r:t.setAttribute(i,""+r),this._mapper.hasOwnProperty(n.value)?this._mapper[n.value].push({name:s?"":i,node:t}):this._mapper[n.value]=[{name:s?"":i,node:t}]})}diactivateState(){slim.remove(this.data)}activateContext(t){const e=this;Array.from(t.attributes).filter(t=>t.name.startsWith("~")).map(a=>{const n=a.name.slice(1);t.removeAttribute(a.name),e._ctxMapper.hasOwnProperty(a.value)?e._ctxMapper[a.value].push({name:n,node:t}):e._ctxMapper[a.value]=[{name:n,node:t}]}),slim.observe(SingleSlim.getInstance(),t=>{t.map(t=>{Object.keys(e._ctxMapper).filter(e=>e.startsWith(t.currentPath)).map(t=>e._ctxMapper[t].map(({name:a,node:n})=>{const s=path(t,e.context);"children"===a?n.innerText=s:(n.setAttribute(a,s),"value"===a&&(n.value=s))}))})})}disconnectedCallback(){this.clearListeners(),this.diactivateState()}applyListeners(t){const e=this;Array.from(t.attributes).filter(t=>t.name.startsWith("@")).map(a=>{if(t.removeAttribute(a.name),e[a.value]instanceof Function){const n=e[a.value].bind(e);t.addEventListener(a.name.slice(1),n),e._listeners.push({el:t,event:a.name.slice(1),handler:n})}})}clearListeners(){this._listeners.map(({el:t,event:e,handler:a})=>t.removeEventListener(e,a)),this._listeners.length=0}}window.MyElement=MyElement,window.exportTag=((t="",e=class extends MyElement{},{shadow:a=!1}={})=>(e.template=e.prototype.template=document.currentScript.parentElement.querySelector("template").cloneNode(!0),e.shadow=e.prototype.shadow=a,document.currentScript.parentElement.querySelector("template").remove(),customElements.define(t,e)));</script> 