<script>const SingleSlim=(()=>{let t;return{getInstance:()=>(t||(t=slim.create({},!0)),t)}})();function path(t="",e){t=Array.isArray(t)?t:t.split(".");let a=e,n=0;for(;n<t.length;){if(null==a)return;a=a[t[n]],n+=1}return a}function set(t,e,a){for(var n=a,s=Array.isArray(t)?t:t.split("."),i=s.length,r=0;r<i-1;r++){var l=s[r];n[l]||(n[l]={}),n=n[l]}n[s[i-1]]=e}class MyElement extends HTMLElement{constructor(){super(),this.observe=slim.observe,this._listeners=[],this._mapper={},this.context=SingleSlim.getInstance(),this._ctxMapper={},this.computed={},this.initState()}connectedCallback(){const t=(stylesheets||[]).reduce((t,e)=>{const a=document.createElement("link");return a.href=e,a.rel="stylesheet",t.appendChild(a),t},document.createDocumentFragment());this.nonShadow?this.appendChild(this.template.content,!0):this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t),this.shadowRoot.appendChild(document.importNode(this.template.content,!0))),this.noBind||this.template.content.querySelectorAll("slot").length||this.compile()}initState(){const t=this,e=(t.data instanceof Function?t.data:()=>t.data||{})();this.data=slim.create(e,!0,e=>{e.map(e=>{Object.keys(t._mapper).filter(t=>t.startsWith(e.currentPath)).map(e=>t._mapper[e].map(({name:a,node:n})=>{const s=path(e,t.data);null!==s&&("children"===a?n.innerText=s:(n.setAttribute(a,s),"value"===a&&(n.value=s)))}))})})}compile(t=this,e={},a=!1){t=t.shadowRoot||t;const n=this;Array.from(t.querySelectorAll("[x-for]")).map(t=>{const[a,s]=t.attributes["x-for"].value.split(":");t.removeAttribute("x-for");const i=t.cloneNode(!0);t.style.display="none",t.className="";const r=document.createDocumentFragment();let l=[];const o=o=>{l.map(t=>t.remove());const p=path(s,n.data)||path(s,e)||[];console.log(p),(l=(Array.isArray(p)?p:Array.from(p)).map((t,n)=>{const s=i.cloneNode(!0);return s.setAttribute("key",n),this.compile(s,Object.assign({},e,{[a]:t}),!0),this.applyListeners(s,Object.assign({},e,{[a]:t})),this.activateBinds(s,Object.assign({},e,{[a]:t})),this.activateContext(s),s})).map(r.appendChild.bind(r)),t.parentNode.insertBefore(r,t.nextSibling)};n.observe(n.data,o.bind(n)),o()}),Array.from(t.querySelectorAll("[x-if]")).map(t=>{const a=t.attributes["x-if"].value;t.removeAttribute("x-if");const s=()=>{const s=path(a,n.computed)instanceof Function?path(a,n.computed):null;path(a,n.data)||path(a,n.context)||path(a,n)||s&&s.call(n,t,e)?"none"===t.style.display&&(t.style.display=t.getAttribute("display")||"block"):"none"!==t.style.display&&(t.setAttribute("display","none"!==t.style.display?t.style.display:""),t.style.display="none")};n.observe(n.data,s.bind(n)),n.observe(n.context,s.bind(n)),s()}),Array.from(t.querySelectorAll("[x-else]")).map(t=>{t.removeAttribute("x-else");const e=()=>{t.previousElementSibling.style&&"none"===t.previousElementSibling.style.display?t.style.display=t.display||t.getAttribute("display")||"block":(t.setAttribute("display","none"!==t.style.display?t.style.display:""),t.style.display="none")};n.observe(n.data,e.bind(n)),n.observe(n.context,e.bind(n)),e()}),Array.from(t.querySelectorAll("*")).filter(t=>!Object.keys(t.attributes).find(t=>t.startsWith("x-"))).map(t=>{this.applyListeners(t,e),this.activateBinds(t,e),this.activateContext(t)})}activateBinds(t,e={}){const a=this;Array.from(t.attributes).filter(t=>t.name.startsWith(":")).map(n=>{t.removeAttribute(n.name);const s=path(n.value,a.computed)instanceof Function?path(n.value,a.computed):null,i=n.name.slice(1),r=path(n.value,e)||(s?s.call(a,t,e):path(n.value,this.data))||"";"children"===i?t.innerText=r:t.setAttribute(i,r),"value"===i&&(t.value=r),this._mapper.hasOwnProperty(n.value)?this._mapper[n.value].push({name:s?"":i,node:t}):this._mapper[n.value]=[{name:s?"":i,node:t}]})}diactivateState(){slim.remove(this.data)}activateContext(t){const e=this;Array.from(t.attributes).filter(t=>t.name.startsWith("~")).map(a=>{const n=a.name.slice(1);t.removeAttribute(a.name),e._ctxMapper.hasOwnProperty(a.value)?e._ctxMapper[a.value].push({name:n,node:t}):e._ctxMapper[a.value]=[{name:n,node:t}]}),slim.observe(SingleSlim.getInstance(),t=>{t.map(t=>{Object.keys(e._ctxMapper).filter(e=>e.startsWith(t.currentPath)).map(t=>e._ctxMapper[t].map(({name:a,node:n})=>{const s=path(t,e.context);"children"===a?n.innerText=s:(n.setAttribute(a,s),"value"===a&&(n.value=s))}))})})}disconnectedCallback(){this.clearListeners(),this.diactivateState()}applyListeners(t,e={}){const a=this;Array.from(t.attributes).filter(t=>t.name.startsWith("@")).map(n=>{if(t.removeAttribute(n.name),a[n.value]instanceof Function){const s=s=>a[n.value].apply(a,[s,t,e]);t.addEventListener(n.name.slice(1),s),a._listeners.push({el:t,event:n.name.slice(1),handler:s})}})}clearListeners(){this._listeners.map(({el:t,event:e,handler:a})=>t.removeEventListener(e,a)),this._listeners.length=0}}window.MyElement=MyElement,window.exportTag=((t="",e=class extends MyElement{},{nonShadow:a=!1,noBind:n=!1}={})=>(e.template=e.prototype.template=document.currentScript.parentElement.querySelector("template").cloneNode(!0),e.nonShadow=e.prototype.nonShadow=a,e.noBind=e.prototype.noBind=n,document.currentScript.parentElement.querySelector("template").remove(),customElements.define(t,e)));</script> 